    <script>
        function DisplayHostList(self){
            $(self).next().toggleClass("hide");
        }

        function CheckAll(self){
            $(self).parent().find("ul :checkbox").prop("checked",$(self).prop("checked"))
            ShowCheckedHostCount();
        }

        function ShowCheckedHostCount(){
            var selected_host_count = $("#host-groups ul").find(":checked").length
            console.log(selected_host_count)
            $("#selected_hosts").text(selected_host_count)
        }

        function GetTaskResult(task_id,task_timeout){
            $.getJSON("{% url 'get_task_result' %}",{"task_id":task_id},function(callback){

                var result_ele = ''
                var all_task_finished = true
                var finished_task_count = 0
                $.each(callback,function(index,item){
                    var p_ele = "<p>" + item.host_user_bind__host__hostname + "(" + item.host_user_bind__host__ip_addr +")------" +
                            item.status + "</p>"
                            item.status + "</p>"
                    var res_ele = "<pre>" + item.result + "</pre>"
                    var single_result = p_ele + res_ele;
                    result_ele += single_result

                    if (item.status == 3){
                        all_task_finished = false;
                    }else{
                        // task not finished yet
                        finished_task_count += 1
                    }
                })
                if (task_timeout_counter < task_timeout){
                {#if (task_timeout_counter < 10){#}
                    task_timeout_counter += 2;
                }else{
                    all_task_finished = true;
                    $.niftyNoty({
                        type: 'danger',
                        container : '#task_result_panel',
                        html : '<h4 class="alert-title">Task timed out!</h4><p class="alert-message">The task has timeouted!</p><div class="mar-top"><button type="button" class="btn btn-info" data-dismiss="noty">Close this notification</button></div>',
                        closeBtn : false
                    });
                }

                if (all_task_finished){
                    clearInterval(result_timer);
                    console.log("timmer cancled...")
                }

                $("#task_result").html(result_ele)
                // set progress bar

                var total_finished_percent = parseInt(finished_task_count / callback.length * 100);
                $("#task_progress").text(total_finished_percent + '%').css("width",total_finished_percent + '%')
            })
        }

        timer_flag = false  // 重复点击的话，不会出现多个result_timer
        function PostTask(task_type){
            //1.验证主机列表已选，命令已输入
            //2.提交任务到后台
            if (timer_flag){
                clearInterval(result_timer)  // 重复点击的话，不会出现多个result_timer
                timer_flag = false
            }
            var selected_host_ids = [];
            var selected_host_eles = $("#host-groups ul").find(":checked")
            $.each(selected_host_eles,function(index,ele){
                selected_host_ids.push($(ele).val())
            })
            {#console.log(selected_host_ids)#}
            if (selected_host_ids.length == 0){
                alert("主机未选择！")
                return false
            }

            if (task_type == "cmd") {
                var cmd_text = $.trim($("#cmd").val())
                if (cmd_text.length == 0) {
                    alert("未输入命令！")
                    return false
                }
            }else{
                //file_transfer
                var remote_path = $("#remote_path").val()
                if ($.trim(remote_path).length==0){
                    alert("must specifiy remote path")
                    return false
                }
            }



            var task_data = {
                'task_type':task_type,
                'selected_host_ids':selected_host_ids,
                //"cmd":cmd_text,
            }
            if (task_type == "cmd") {
                task_data['cmd'] = cmd_text
            }else{
                var file_transfer_type = $("select[name='transfer-type']").val()
                task_data['file_transfer_type'] = file_transfer_type
                task_data['random_str'] = '{{ random_str }}'
                task_data['remote_path'] = $('#remote_path').val()
            }



            $.post("{% url 'multitask' %}",{"csrfmiddlewaretoken":"{{ csrf_token }}","task_data":JSON.stringify(task_data)},function(callback){
                console.log(callback);
                var callback = JSON.parse(callback);

                GetTaskResult(callback.task_id,callback.timeout);
                task_timeout_counter = 0
                result_timer = setInterval(function(){
                    GetTaskResult(callback.task_id,callback.timeout);

                },2000)
                timer_flag=true

                // display download file btn
                $("#file_download_btn").removeClass("hide").attr("href","{% url 'task_file_download' %}?task_id="+callback.task_id);


            })//end post
        }

    </script>